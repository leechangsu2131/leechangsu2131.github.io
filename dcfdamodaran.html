<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ê¸‰ DCF ê°€ì¹˜í‰ê°€ ê³„ì‚°ê¸° - ë‹¤ì¤‘ í™•ë¥ ë¶„í¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            height: fit-content;
            overflow-y: auto;
            max-height: 90vh;
        }
        
        .input-section:hover {
            border-color: #3498db;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.1);
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .variable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .variable-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
        }
        
        .distribution-select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            font-size: 0.85rem;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }
        
        .param-item {
            text-align: center;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #34495e;
            font-size: 0.85rem;
        }
        
        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
        }
        
        .distribution-info {
            background: #e8f4f8;
            padding: 8px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.8rem;
            color: #2c3e50;
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(46, 204, 113, 0.3);
        }
        
        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .results-card {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 15px;
        }
        
        .large-chart {
            height: 400px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .valuation-summary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }
        
        .valuation-summary h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .final-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .confidence-interval {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .projection-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            font-size: 0.85rem;
        }
        
        .projection-table th,
        .projection-table td {
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }
        
        .projection-table th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            font-weight: 600;
        }
        
        .loading {
            display: none;
            text-align: center;
            color: #3498db;
            font-size: 1.1rem;
            padding: 20px;
        }
        
        .percentile-table {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .risk-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }
        
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .results-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ê³ ê¸‰ DCF ê°€ì¹˜í‰ê°€ ê³„ì‚°ê¸°</h1>
            <p>ë‹¤ì¤‘ í™•ë¥ ë¶„í¬ì™€ ëª¬í…Œì¹´ë¥¼ë¡œ ì‹œë®¬ë ˆì´ì…˜ì„ í†µí•œ ì •êµí•œ ê°€ì¹˜í‰ê°€</p>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">ğŸ”¢ ê¸°ë³¸ ì •ë³´</h2>
                
                <div style="margin-bottom: 20px;">
                    <label for="company-name">ê¸°ì—…ëª…</label>
                    <input type="text" id="company-name" placeholder="ì˜ˆ: ì•Œë¦¬ë°”ë°”">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="base-revenue">ê¸°ì¤€ë…„ë„ ë§¤ì¶œì•¡ (ë°±ë§Œì›)</label>
                    <input type="number" id="base-revenue" value="100000">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="shares-outstanding">ë°œí–‰ì£¼ì‹ìˆ˜ (ë°±ë§Œì£¼)</label>
                    <input type="number" id="shares-outstanding" value="2650">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="simulations">ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜</label>
                    <input type="number" id="simulations" value="2000" min="500" max="10000">
                </div>

                <h3 style="color: #2c3e50; margin: 25px 0 15px 0; font-size: 1.2rem;">ğŸ“Š í™•ë¥ ë³€ìˆ˜ ì„¤ì •</h3>
                
                <!-- ë§¤ì¶œì„±ì¥ë¥  -->
                <div class="input-group">
                    <div class="variable-header">
                        <span class="variable-name">ğŸ“ˆ ë§¤ì¶œì„±ì¥ë¥  (ì²« 5ë…„, %)</span>
                        <select class="distribution-select" id="growth-dist" onchange="updateDistributionParams('growth')">
                            <option value="lognormal">ë¡œê·¸ì •ê·œë¶„í¬</option>
                            <option value="normal">ì •ê·œë¶„í¬</option>
                            <option value="uniform">ê· ë“±ë¶„í¬</option>
                            <option value="triangular">ì‚¼ê°ë¶„í¬</option>
                            <option value="beta">ë² íƒ€ë¶„í¬</option>
                        </select>
                    </div>
                    <div class="param-grid" id="growth-params">
                        <div class="param-item">
                            <label>Î¼ (ë¡œê·¸í‰ê· )</label>
                            <input type="number" id="growth-param1" value="2.94" step="0.01">
                        </div>
                        <div class="param-item">
                            <label>Ïƒ (ë¡œê·¸í‘œì¤€í¸ì°¨)</label>
                            <input type="number" id="growth-param2" value="0.25" step="0.01">
                        </div>
                    </div>
                    <div class="distribution-info" id="growth-info">
                        ë¡œê·¸ì •ê·œë¶„í¬: ê³±ì…ˆì  ì„±ì¥ ê³¼ì •ì— ì í•©. í‰ê·  â‰ˆ 20%, ë³€ë™ì„± ê³ ë ¤
                    </div>
                </div>
                
                <!-- ì˜ì—…ì´ìµë¥  -->
                <div class="input-group">
                    <div class="variable-header">
                        <span class="variable-name">ğŸ’° ì˜ì—…ì´ìµë¥  (%)</span>
                        <select class="distribution-select" id="margin-dist" onchange="updateDistributionParams('margin')">
                            <option value="triangular">ì‚¼ê°ë¶„í¬</option>
                            <option value="beta">ë² íƒ€ë¶„í¬</option>
                            <option value="uniform">ê· ë“±ë¶„í¬</option>
                            <option value="normal">ì •ê·œë¶„í¬</option>
                        </select>
                    </div>
                    <div class="param-grid" id="margin-params">
                        <div class="param-item">
                            <label>ìµœì†Ÿê°’</label>
                            <input type="number" id="margin-param1" value="15" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ìµœë¹ˆê°’</label>
                            <input type="number" id="margin-param2" value="25" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ìµœëŒ“ê°’</label>
                            <input type="number" id="margin-param3" value="35" step="0.1">
                        </div>
                    </div>
                    <div class="distribution-info" id="margin-info">
                        ì‚¼ê°ë¶„í¬: ìµœì†Œ/ìµœë¹ˆ/ìµœëŒ€ê°’ ì¶”ì • ê°€ëŠ¥í•œ ê²½ìš°ì— ì í•©
                    </div>
                </div>
                
                <!-- ì¬íˆ¬ììœ¨ -->
                <div class="input-group">
                    <div class="variable-header">
                        <span class="variable-name">ğŸ”„ ì¬íˆ¬ììœ¨ (%)</span>
                        <select class="distribution-select" id="reinvest-dist" onchange="updateDistributionParams('reinvest')">
                            <option value="beta">ë² íƒ€ë¶„í¬</option>
                            <option value="triangular">ì‚¼ê°ë¶„í¬</option>
                            <option value="uniform">ê· ë“±ë¶„í¬</option>
                            <option value="normal">ì •ê·œë¶„í¬</option>
                        </select>
                    </div>
                    <div class="param-grid" id="reinvest-params">
                        <div class="param-item">
                            <label>Î± (ì•ŒíŒŒ)</label>
                            <input type="number" id="reinvest-param1" value="4" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>Î² (ë² íƒ€)</label>
                            <input type="number" id="reinvest-param2" value="6" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ë²”ìœ„(0-100%)</label>
                            <input type="number" id="reinvest-param3" value="80" step="1">
                        </div>
                    </div>
                    <div class="distribution-info" id="reinvest-info">
                        ë² íƒ€ë¶„í¬: 0-100% ë²”ìœ„ì—ì„œ ì¹˜ìš°ì¹¨ ì •ë„ ì¡°ì ˆ ê°€ëŠ¥
                    </div>
                </div>
                
                <!-- í• ì¸ìœ¨ -->
                <div class="input-group">
                    <div class="variable-header">
                        <span class="variable-name">ğŸ’¹ í• ì¸ìœ¨ (WACC, %)</span>
                        <select class="distribution-select" id="discount-dist" onchange="updateDistributionParams('discount')">
                            <option value="normal">ì •ê·œë¶„í¬</option>
                            <option value="triangular">ì‚¼ê°ë¶„í¬</option>
                            <option value="uniform">ê· ë“±ë¶„í¬</option>
                            <option value="gamma">ê°ë§ˆë¶„í¬</option>
                        </select>
                    </div>
                    <div class="param-grid" id="discount-params">
                        <div class="param-item">
                            <label>í‰ê· </label>
                            <input type="number" id="discount-param1" value="10" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>í‘œì¤€í¸ì°¨</label>
                            <input type="number" id="discount-param2" value="1.5" step="0.1">
                        </div>
                    </div>
                    <div class="distribution-info" id="discount-info">
                        ì •ê·œë¶„í¬: ì—¬ëŸ¬ ìš”ì†Œì˜ ì¡°í•©ìœ¼ë¡œ ì¤‘ì‹¬ê·¹í•œì •ë¦¬ ì ìš©
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label for="terminal-growth">ì˜êµ¬ì„±ì¥ë¥  (%, ê³ ì •ê°’)</label>
                    <input type="number" id="terminal-growth" value="3" step="0.1">
                </div>
                
                <button class="calculate-btn" onclick="runAdvancedSimulation()">ğŸ² ê³ ê¸‰ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
                
                <div class="loading" id="loading">
                    <div>â³ ì‹œë®¬ë ˆì´ì…˜ ì§„í–‰ ì¤‘...</div>
                    <div id="progress" style="margin-top: 10px; font-size: 0.9rem;"></div>
                </div>
            </div>
            
            <div class="results-section">
                <div class="results-card full-width">
                    <div class="valuation-summary">
                        <h3>ğŸ¯ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</h3>
                        <div>í‰ê·  ì£¼ë‹¹ê°€ì¹˜: <span class="final-value" id="mean-price">-</span> ì›</div>
                        <div class="confidence-interval">
                            <div><strong>95% ì‹ ë¢°êµ¬ê°„</strong></div>
                            <div id="confidence-range">ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”</div>
                            <div style="margin-top: 10px; font-size: 0.9rem;">
                                <span id="risk-assessment">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="results-card">
                    <h3 class="section-title">ğŸ“Š ê°€ì¹˜ ë¶„í¬</h3>
                    <div class="chart-container">
                        <canvas id="distribution-chart"></canvas>
                    </div>
                </div>
                
                <div class="results-card">
                    <h3 class="section-title">ğŸ“ˆ í†µê³„ ìš”ì•½</h3>
                    <div class="stats-grid" id="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="stat-mean">-</div>
                            <div class="stat-label">í‰ê· ê°’</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-median">-</div>
                            <div class="stat-label">ì¤‘ì•™ê°’</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-std">-</div>
                            <div class="stat-label">í‘œì¤€í¸ì°¨</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-cv">-</div>
                            <div class="stat-label">ë³€ë™ê³„ìˆ˜</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-skew">-</div>
                            <div class="stat-label">ì™œë„</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="stat-downside">-</div>
                            <div class="stat-label">í•˜ë°©ìœ„í—˜(%)</div>
                        </div>
                    </div>
                </div>
                
                <div class="results-card">
                    <h3 class="section-title">ğŸ¯ ë¯¼ê°ë„ ë¶„ì„</h3>
                    <div class="chart-container">
                        <canvas id="sensitivity-chart"></canvas>
                    </div>
                </div>
                
                <div class="results-card">
                    <h3 class="section-title">ğŸ“ˆ ë°±ë¶„ìœ„ ë¶„ì„</h3>
                    <div class="chart-container">
                        <canvas id="percentile-chart"></canvas>
                    </div>
                </div>
                
                <div class="results-card full-width">
                    <h3 class="section-title">ğŸ“‹ ì¬ë¬´ ì˜ˆì¸¡ (ê¸°ëŒ“ê°’ ê¸°ì¤€)</h3>
                    <table class="projection-table" id="projection-table">
                        <thead>
                            <tr>
                                <th>ì—°ë„</th>
                                <th>ë§¤ì¶œì•¡</th>
                                <th>ì˜ì—…ì´ìµ</th>
                                <th>NOPAT</th>
                                <th>ì¬íˆ¬ì</th>
                                <th>FCF</th>
                                <th>í˜„ì¬ê°€ì¹˜</th>
                            </tr>
                        </thead>
                        <tbody id="projection-body">
                            <tr><td colspan="7">ì‹œë®¬ë ˆì´ì…˜ì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let distributionChart, sensitivityChart, percentileChart;
        
        function formatNumber(num) {
            if (Math.abs(num) >= 1000) {
                return new Intl.NumberFormat('ko-KR').format(Math.round(num));
            } else {
                return num.toFixed(2);
            }
        }
        
        // ë‹¤ì–‘í•œ í™•ë¥ ë¶„í¬ ìƒì„± í•¨ìˆ˜ë“¤
        function generateNormal(mean, std) {
            let u1 = Math.random();
            let u2 = Math.random();
            let z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            return z0 * std + mean;
        }
        
        function generateLogNormal(logMean, logStd) {
            const normal = generateNormal(logMean, logStd);
            return Math.exp(normal);
        }
        
        function generateUniform(min, max) {
            return Math.random() * (max - min) + min;
        }
        
        function generateTriangular(min, mode, max) {
            const u = Math.random();
            const c = (mode - min) / (max - min);
            
            if (u < c) {
                return min + Math.sqrt(u * (max - min) * (mode - min));
            } else {
                return max - Math.sqrt((1 - u) * (max - min) * (max - mode));
            }
        }
        
        function generateBeta(alpha, beta, min = 0, max = 1) {
            // Beta ë¶„í¬ ê·¼ì‚¬ (ê°„ë‹¨í•œ êµ¬í˜„)
            let sum = 0;
            for (let i = 0; i < alpha + beta; i++) {
                if (i < alpha) sum += Math.random();
            }
            const betaValue = sum / alpha;
            return min + betaValue * (max - min);
        }
        
        function generateGamma(shape, scale) {
            // Gamma ë¶„í¬ ê·¼ì‚¬
            if (shape < 1) {
                return generateGamma(shape + 1, scale) * Math.pow(Math.random(), 1/shape);
            }
            
            const d = shape - 1/3;
            const c = 1 / Math.sqrt(9 * d);
            
            while (true) {
                let x, v;
                do {
                    x = generateNormal(0, 1);
                    v = 1 + c * x;
                } while (v <= 0);
                
                v = v * v * v;
                const u = Math.random();
                
                if (u < 1 - 0.0331 * x * x * x * x) {
                    return d * v * scale;
                }
                
                if (Math.log(u) < 0.5 * x * x + d * (1 - v + Math.log(v))) {
                    return d * v * scale;
                }
            }
        }
        
        function sampleFromDistribution(distType, params) {
            switch (distType) {
                case 'normal':
                    return generateNormal(params[0], params[1]);
                case 'lognormal':
                    return generateLogNormal(params[0], params[1]);
                case 'uniform':
                    return generateUniform(params[0], params[1]);
                case 'triangular':
                    return generateTriangular(params[0], params[1], params[2]);
                case 'beta':
                    return generateBeta(params[0], params[1], 0, params[2] || 100);
                case 'gamma':
                    return generateGamma(params[0], params[1]);
                default:
                    return params[0];
            }
        }
        
        function updateDistributionParams(variable) {
            const distType = document.getElementById(`${variable}-dist`).value;
            const paramsContainer = document.getElementById(`${variable}-params`);
            const infoContainer = document.getElementById(`${variable}-info`);
            
            let paramsHTML = '';
            let infoText = '';
            
            switch (distType) {
                case 'normal':
                    paramsHTML = `
                        <div class="param-item">
                            <label>í‰ê· </label>
                            <input type="number" id="${variable}-param1" value="20" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>í‘œì¤€í¸ì°¨</label>
                            <input type="number" id="${variable}-param2" value="5" step="0.1">
                        </div>
                    `;
                    infoText = 'ì •ê·œë¶„í¬: ì—¬ëŸ¬ ìš”ì†Œì˜ ì¡°í•©, ì¤‘ì‹¬ê·¹í•œì •ë¦¬ ì ìš©';
                    break;
                    
                case 'lognormal':
                    paramsHTML = `
                        <div class="param-item">
                            <label>Î¼ (ë¡œê·¸í‰ê· )</label>
                            <input type="number" id="${variable}-param1" value="2.94" step="0.01">
                        </div>
                        <div class="param-item">
                            <label>Ïƒ (ë¡œê·¸í‘œì¤€í¸ì°¨)</label>
                            <input type="number" id="${variable}-param2" value="0.25" step="0.01">
                        </div>
                    `;
                    infoText = 'ë¡œê·¸ì •ê·œë¶„í¬: ê³±ì…ˆì  ì„±ì¥ ê³¼ì •, í•­ìƒ ì–‘ìˆ˜';
                    break;
                    
                case 'uniform':
                    paramsHTML = `
                        <div class="param-item">
                            <label>ìµœì†Ÿê°’</label>
                            <input type="number" id="${variable}-param1" value="10" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ìµœëŒ“ê°’</label>
                            <input type="number" id="${variable}-param2" value="30" step="0.1">
                        </div>
                    `;
                    infoText = 'ê· ë“±ë¶„í¬: ëª¨ë“  ê²½ìš°ê°€ ë™ë“±í•˜ê²Œ ê°€ëŠ¥, ìµœëŒ€ ì—”íŠ¸ë¡œí”¼';
                    break;
                    
                case 'triangular':
                    paramsHTML = `
                        <div class="param-item">
                            <label>ìµœì†Ÿê°’</label>
                            <input type="number" id="${variable}-param1" value="15" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ìµœë¹ˆê°’</label>
                            <input type="number" id="${variable}-param2" value="25" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ìµœëŒ“ê°’</label>
                            <input type="number" id="${variable}-param3" value="35" step="0.1">
                        </div>
                    `;
                    infoText = 'ì‚¼ê°ë¶„í¬: ìµœì†Œ/ìµœë¹ˆ/ìµœëŒ€ê°’ ì¶”ì • ê°€ëŠ¥í•œ ê²½ìš°';
                    break;
                    
                case 'beta':
                    const defaultMax = variable === 'reinvest' ? 80 : (variable === 'margin' ? 50 : 100);
                    paramsHTML = `
                        <div class="param-item">
                            <label>Î± (ì•ŒíŒŒ)</label>
                            <input type="number" id="${variable}-param1" value="4" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>Î² (ë² íƒ€)</label>
                            <input type="number" id="${variable}-param2" value="6" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ìµœëŒ“ê°’</label>
                            <input type="number" id="${variable}-param3" value="${defaultMax}" step="1">
                        </div>
                    `;
                    infoText = 'ë² íƒ€ë¶„í¬: ìœ í•œ êµ¬ê°„ì—ì„œ ì¹˜ìš°ì¹¨ ì •ë„ ì¡°ì ˆ ê°€ëŠ¥';
                    break;
                    
                case 'gamma':
                    paramsHTML = `
                        <div class="param-item">
                            <label>í˜•íƒœëª¨ìˆ˜(k)</label>
                            <input type="number" id="${variable}-param1" value="4" step="0.1">
                        </div>
                        <div class="param-item">
                            <label>ì²™ë„ëª¨ìˆ˜(Î¸)</label>
                            <input type="number" id="${variable}-param2" value="2.5" step="0.1">
                        </div>
                    `;
                    infoText = 'ê°ë§ˆë¶„í¬: ì–‘ì˜ ì™œë„ë¥¼ ê°€ì§„ ì—°ì†ë¶„í¬';
                    break;
            }
            
            paramsContainer.innerHTML = paramsHTML;
            infoContainer.textContent = infoText;
        }
        
        function calculateSingleDCF(params) {
            const {
                baseRevenue, revenueGrowth, operatingMargin, reinvestmentRate,
                discountRate, terminalGrowth, sharesOutstanding
            } = params;
            
            const taxRate = 0.25;
            let projections = [];
            let totalPV = 0;
            
            // 10ë…„ ì˜ˆì¸¡
            for (let year = 1; year <= 10; year++) {
                let growthRate;
                if (year <= 5) {
                    growthRate = revenueGrowth / 100;
                } else {
                    // 6ë…„ì°¨ë¶€í„° ì ì§„ì  ê°ì†Œ
                    const declineRate = (revenueGrowth - terminalGrowth) / 5;
                    growthRate = Math.max((revenueGrowth - (year - 5) * declineRate) / 100, terminalGrowth / 100);
                }
                
                const revenue = year === 1 ? 
                    baseRevenue * (1 + growthRate) : 
                    projections[year-2].revenue * (1 + growthRate);
                
                const operatingIncome = revenue * (operatingMargin / 100);
                const nopat = operatingIncome * (1 - taxRate);
                const reinvestment = nopat * (reinvestmentRate / 100);
                const fcf = nopat - reinvestment;
                
                const discountFactor = Math.pow(1 + discountRate/100, year);
                const presentValue = fcf / discountFactor;
                
                totalPV += presentValue;
                
                projections.push({
                    year: year,
                    revenue: revenue,
                    operatingIncome: operatingIncome,
                    nopat: nopat,
                    reinvestment: reinvestment,
                    fcf: fcf,
                    presentValue: presentValue
                });
            }
            
            // í„°ë¯¸ë„ ê°€ì¹˜
            const terminalFCF = projections[9].fcf * (1 + terminalGrowth/100);
            const terminalValue = terminalFCF / (discountRate/100 - terminalGrowth/100);
            const terminalPV = terminalValue / Math.pow(1 + discountRate/100, 10);
            
            const enterpriseValue = totalPV + terminalPV;
            const sharePrice = (enterpriseValue * 1000000) / (sharesOutstanding * 1000000);
            
            return {
                sharePrice,
                enterpriseValue,
                projections,
                terminalValue,
                terminalPV
            };
        }
        
        async function runAdvancedSimulation() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('progress').textContent = '';
            
            const baseRevenue = parseFloat(document.getElementById('base-revenue').value) || 100000;
            const terminalGrowth = parseFloat(document.getElementById('terminal-growth').value) || 3;
            const sharesOutstanding = parseFloat(document.getElementById('shares-outstanding').value) || 2650;
            const simulations = parseInt(document.getElementById('simulations').value) || 2000;
            
            let results = [];
            let sensitivityData = [];
            
            // ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
            for (let i = 0; i < simulations; i++) {
                // ê° ë³€ìˆ˜ë³„ ë¶„í¬ì—ì„œ ìƒ˜í”Œë§
                const revenueGrowth = Math.max(0.1, sampleFromDistribution(
                    document.getElementById('growth-dist').value,
                    [
                        parseFloat(document.getElementById('growth-param1').value),
                        parseFloat(document.getElementById('growth-param2').value),
                        parseFloat(document.getElementById('growth-param3')?.value)
                    ].filter(x => !isNaN(x))
                ));
                
                const operatingMargin = Math.max(0.1, Math.min(100, sampleFromDistribution(
                    document.getElementById('margin-dist').value,
                    [
                        parseFloat(document.getElementById('margin-param1').value),
                        parseFloat(document.getElementById('margin-param2').value),
                        parseFloat(document.getElementById('margin-param3')?.value)
                    ].filter(x => !isNaN(x))
                )));
                
                const reinvestmentRate = Math.max(0, Math.min(100, sampleFromDistribution(
                    document.getElementById('reinvest-dist').value,
                    [
                        parseFloat(document.getElementById('reinvest-param1').value),
                        parseFloat(document.getElementById('reinvest-param2').value),
                        parseFloat(document.getElementById('reinvest-param3')?.value)
                    ].filter(x => !isNaN(x))
                )));
                
                const discountRate = Math.max(1, sampleFromDistribution(
                    document.getElementById('discount-dist').value,
                    [
                        parseFloat(document.getElementById('discount-param1').value),
                        parseFloat(document.getElementById('discount-param2').value),
                        parseFloat(document.getElementById('discount-param3')?.value)
                    ].filter(x => !isNaN(x))
                ));
                
                const params = {
                    baseRevenue,
                    revenueGrowth,
                    operatingMargin,
                    reinvestmentRate,
                    discountRate,
                    terminalGrowth,
                    sharesOutstanding
                };
                
                const result = calculateSingleDCF(params);
                results.push(result.sharePrice);
                
                // ë¯¼ê°ë„ ë¶„ì„ìš© ë°ì´í„° ìˆ˜ì§‘
                if (i < 100) {
                    sensitivityData.push({
                        sharePrice: result.sharePrice,
                        revenueGrowth,
                        operatingMargin,
                        reinvestmentRate,
                        discountRate
                    });
                }
                
                // ì§„í–‰ë¥  í‘œì‹œ
                if (i % 200 === 0) {
                    const progress = Math.round((i / simulations) * 100);
                    document.getElementById('progress').textContent = `${progress}% ì™„ë£Œ`;
                    await new Promise(resolve => setTimeout(resolve, 1));
                }
            }
            
            // ê²°ê³¼ ë¶„ì„
            results.sort((a, b) => a - b);
            const stats = calculateAdvancedStats(results);
            
            // ê¸°ëŒ“ê°’ ê³„ì‚°ìš© í‰ê·  íŒŒë¼ë¯¸í„°
            const avgParams = getAverageParams();
            const baselineResult = calculateSingleDCF(avgParams);
            
            // UI ì—…ë°ì´íŠ¸
            updateAdvancedResults(stats, results);
            updateDistributionChart(results);
            updateAdvancedSensitivityChart(sensitivityData);
            updatePercentileChart(results);
            updateProjectionTable(baselineResult.projections, baselineResult.terminalValue, baselineResult.terminalPV);
            
            document.getElementById('loading').style.display = 'none';
        }
        
        function calculateAdvancedStats(results) {
            const n = results.length;
            const mean = results.reduce((sum, val) => sum + val, 0) / n;
            const median = results[Math.floor(n / 2)];
            
            const variance = results.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / n;
            const std = Math.sqrt(variance);
            const cv = (std / mean) * 100; // ë³€ë™ê³„ìˆ˜
            
            // ì™œë„ ê³„ì‚°
            const skewness = results.reduce((sum, val) => sum + Math.pow((val - mean) / std, 3), 0) / n;
            
            // í•˜ë°©ìœ„í—˜ (í‰ê·  ì´í•˜ í™•ë¥ )
            const downsideRisk = (results.filter(x => x < mean).length / n) * 100;
            
            const p5 = results[Math.floor(n * 0.025)];
            const p95 = results[Math.floor(n * 0.975)];
            const p90 = results[Math.floor(n * 0.9)];
            const min = results[0];
            const max = results[results.length - 1];
            
            return { mean, median, std, cv, skewness, downsideRisk, p5, p95, p90, min, max };
        }
        
        function getAverageParams() {
            // ê° ë¶„í¬ì˜ ê¸°ëŒ“ê°’ ê³„ì‚°
            let avgGrowth, avgMargin, avgReinvest, avgDiscount;
            
            const growthDist = document.getElementById('growth-dist').value;
            const growthParams = [
                parseFloat(document.getElementById('growth-param1').value),
                parseFloat(document.getElementById('growth-param2').value)
            ];
            
            switch (growthDist) {
                case 'lognormal':
                    avgGrowth = Math.exp(growthParams[0] + 0.5 * growthParams[1] * growthParams[1]);
                    break;
                case 'uniform':
                    avgGrowth = (growthParams[0] + growthParams[1]) / 2;
                    break;
                case 'triangular':
                    const growthMax = parseFloat(document.getElementById('growth-param3').value);
                    avgGrowth = (growthParams[0] + growthParams[1] + growthMax) / 3;
                    break;
                default:
                    avgGrowth = growthParams[0];
            }
            
            // ë‹¤ë¥¸ ë³€ìˆ˜ë“¤ë„ ìœ ì‚¬í•˜ê²Œ ê³„ì‚°
            avgMargin = getDistributionMean('margin');
            avgReinvest = getDistributionMean('reinvest');
            avgDiscount = getDistributionMean('discount');
            
            return {
                baseRevenue: parseFloat(document.getElementById('base-revenue').value),
                revenueGrowth: avgGrowth,
                operatingMargin: avgMargin,
                reinvestmentRate: avgReinvest,
                discountRate: avgDiscount,
                terminalGrowth: parseFloat(document.getElementById('terminal-growth').value),
                sharesOutstanding: parseFloat(document.getElementById('shares-outstanding').value)
            };
        }
        
        function getDistributionMean(variable) {
            const distType = document.getElementById(`${variable}-dist`).value;
            const param1 = parseFloat(document.getElementById(`${variable}-param1`).value);
            const param2 = parseFloat(document.getElementById(`${variable}-param2`).value);
            const param3 = parseFloat(document.getElementById(`${variable}-param3`)?.value);
            
            switch (distType) {
                case 'normal':
                    return param1;
                case 'lognormal':
                    return Math.exp(param1 + 0.5 * param2 * param2);
                case 'uniform':
                    return (param1 + param2) / 2;
                case 'triangular':
                    return (param1 + param2 + param3) / 3;
                case 'beta':
                    return (param1 / (param1 + param2)) * (param3 || 100);
                case 'gamma':
                    return param1 * param2;
                default:
                    return param1;
            }
        }
        
        function updateAdvancedResults(stats, results) {
            document.getElementById('mean-price').textContent = formatNumber(stats.mean);
            document.getElementById('confidence-range').innerHTML = 
                `<strong>${formatNumber(stats.p5)}ì› ~ ${formatNumber(stats.p95)}ì›</strong>`;
            
            // ìœ„í—˜ í‰ê°€
            let riskLevel, riskColor;
            if (stats.cv < 20) {
                riskLevel = "ë‚®ìŒ";
                riskColor = "#27ae60";
            } else if (stats.cv < 40) {
                riskLevel = "ë³´í†µ";
                riskColor = "#f39c12";
            } else {
                riskLevel = "ë†’ìŒ";
                riskColor = "#e74c3c";
            }
            
            document.getElementById('risk-assessment').innerHTML = 
                `<span style="color: ${riskColor};">íˆ¬ììœ„í—˜: ${riskLevel}</span> (ë³€ë™ê³„ìˆ˜: ${stats.cv.toFixed(1)}%)`;
            
            document.getElementById('stat-mean').textContent = formatNumber(stats.mean) + 'ì›';
            document.getElementById('stat-median').textContent = formatNumber(stats.median) + 'ì›';
            document.getElementById('stat-std').textContent = formatNumber(stats.std) + 'ì›';
            document.getElementById('stat-cv').textContent = stats.cv.toFixed(1) + '%';
            document.getElementById('stat-skew').textContent = stats.skewness.toFixed(2);
            document.getElementById('stat-downside').textContent = stats.downsideRisk.toFixed(1) + '%';
        }
        
        function updateDistributionChart(results) {
            const ctx = document.getElementById('distribution-chart').getContext('2d');
            
            // íˆìŠ¤í† ê·¸ë¨ ë°ì´í„° ìƒì„±
            const bins = 40;
            const min = Math.min(...results);
            const max = Math.max(...results);
            const binWidth = (max - min) / bins;
            
            const histogram = new Array(bins).fill(0);
            const labels = [];
            
            for (let i = 0; i < bins; i++) {
                const binCenter = min + (i + 0.5) * binWidth;
                labels.push(formatNumber(binCenter));
            }
            
            results.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binWidth), bins - 1);
                histogram[binIndex]++;
            });
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            distributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'ë¹ˆë„',
                        data: histogram,
                        backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1,
                        borderRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `ê°€ì¹˜: ${context[0].label}ì›`;
                                },
                                label: function(context) {
                                    return `ë¹ˆë„: ${context.parsed.y}íšŒ`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: { display: false },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'ë¹ˆë„' }
                        }
                    }
                }
            });
        }
        
        function updateAdvancedSensitivityChart(sensitivityData) {
            const ctx = document.getElementById('sensitivity-chart').getContext('2d');
            
            // ìƒê´€ê´€ê³„ ë¶„ì„
            const variables = ['revenueGrowth', 'operatingMargin', 'reinvestmentRate', 'discountRate'];
            const names = ['ë§¤ì¶œì„±ì¥ë¥ ', 'ì˜ì—…ì´ìµë¥ ', 'ì¬íˆ¬ììœ¨', 'í• ì¸ìœ¨'];
            const correlations = [];
            
            variables.forEach((variable, index) => {
                const prices = sensitivityData.map(d => d.sharePrice);
                const values = sensitivityData.map(d => d[variable]);
                
                const correlation = calculateCorrelation(prices, values);
                correlations.push(Math.abs(correlation) * 100);
            });
            
            if (sensitivityChart) {
                sensitivityChart.destroy();
            }
            
            sensitivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: names,
                    datasets: [{
                        label: 'ê°€ì¹˜ ìƒê´€ë„ (%)',
                        data: correlations,
                        backgroundColor: [
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(155, 89, 182, 0.8)'
                        ],
                        borderColor: [
                            'rgba(231, 76, 60, 1)',
                            'rgba(52, 152, 219, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(155, 89, 182, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `ìƒê´€ë„: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'ì ˆëŒ€ ìƒê´€ë„ (%)' }
                        }
                    },
                    animation: { duration: 1500, easing: 'easeOutCubic' }
                }
            });
        }
        
        function updatePercentileChart(results) {
            const ctx = document.getElementById('percentile-chart').getContext('2d');
            
            const percentiles = [5, 10, 25, 50, 75, 90, 95];
            const percentileValues = percentiles.map(p => {
                const index = Math.floor(results.length * p / 100);
                return results[Math.min(index, results.length - 1)];
            });
            
            if (percentileChart) {
                percentileChart.destroy();
            }
            
            percentileChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: percentiles.map(p => `${p}%`),
                    datasets: [{
                        label: 'ë°±ë¶„ìœ„ ê°€ì¹˜',
                        data: percentileValues,
                        borderColor: 'rgba(52, 152, 219, 1)',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label} ë°±ë¶„ìœ„: ${formatNumber(context.parsed.y)}ì›`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: { display: true, text: 'ì£¼ë‹¹ê°€ì¹˜ (ì›)' },
                            ticks: {
                                callback: function(value) {
                                    return formatNumber(value) + 'ì›';
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'ë°±ë¶„ìœ„' }
                        }
                    },
                    animation: { duration: 2000, easing: 'easeOutBounce' }
                }
            });
        }
        
        function calculateCorrelation(x, y) {
            const n = x.length;
            const meanX = x.reduce((sum, val) => sum + val, 0) / n;
            const meanY = y.reduce((sum, val) => sum + val, 0) / n;
            
            const numerator = x.reduce((sum, val, i) => sum + (val - meanX) * (y[i] - meanY), 0);
            const denomX = Math.sqrt(x.reduce((sum, val) => sum + Math.pow(val - meanX, 2), 0));
            const denomY = Math.sqrt(y.reduce((sum, val) => sum + Math.pow(val - meanY, 2), 0));
            
            return numerator / (denomX * denomY);
        }
        
        function updateProjectionTable(projections, terminalValue, terminalPV) {
            const tbody = document.getElementById('projection-body');
            tbody.innerHTML = '';
            
            projections.forEach(proj => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${proj.year}ë…„ì°¨</td>
                    <td>${formatNumber(proj.revenue)}</td>
                    <td>${formatNumber(proj.operatingIncome)}</td>
                    <td>${formatNumber(proj.nopat)}</td>
                    <td>${formatNumber(proj.reinvestment)}</td>
                    <td>${formatNumber(proj.fcf)}</td>
                    <td>${formatNumber(proj.presentValue)}</td>
                `;
            });
            
            // í„°ë¯¸ë„ ê°€ì¹˜ í–‰
            const terminalRow = tbody.insertRow();
            terminalRow.innerHTML = `
                <td><strong>í„°ë¯¸ë„</strong></td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
                <td>${formatNumber(terminalValue)}</td>
                <td><strong>${formatNumber(terminalPV)}</strong></td>
            `;
            terminalRow.style.backgroundColor = '#e8f4f8';
            terminalRow.style.fontWeight = 'bold';
        }
        
        // ë¶„í¬ë³„ ë§¤ê°œë³€ìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function initializeDistributionParams() {
            updateDistributionParams('growth');
            updateDistributionParams('margin'); 
            updateDistributionParams('reinvest');
            updateDistributionParams('discount');
        }
        
        // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì„¤ì •
        function setupRealTimeUpdate() {
            const inputs = document.querySelectorAll('input[type="number"], select');
            let timeoutId;
            
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => {
                        if (document.getElementById('mean-price').textContent !== '-') {
                            runAdvancedSimulation();
                        }
                    }, 1500);
                });
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            initializeDistributionParams();
            setupRealTimeUpdate();
            runAdvancedSimulation();
        };
    </script>
</body>
</html>
